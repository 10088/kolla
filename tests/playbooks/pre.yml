---
- hosts: all
  roles:
    - bindep
  tasks:
    - name: Create dir for kolla logs
      file:
        path: "{{ kolla_logs_dir }}"
        state: directory

    - name: Dump host info to logs
      command: "{{ ansible_user_dir }}/{{ zuul.project.src_dir }}/tools/dump_info.sh"
      args:
        chdir: "{{ kolla_logs_dir }}"

    - name: Create dir for kolla build logs
      file:
        path: "{{ kolla_build_logs_dir }}"
        state: directory

    - name: Install Python3 setuptools and family
      package:
        name:
          - python3-pip
          - python3-setuptools
          - python3-virtualenv
          - python3-wheel
      become: true

    - name: Install kolla
      pip:
        name: .
        chdir: "{{ zuul.project.src_dir }}"
        virtualenv: "{{ virtualenv_path }}"
        virtualenv_python: python3
